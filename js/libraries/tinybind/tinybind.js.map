{"version":3,"file":"tinybind.js","sources":["../src/constants.js","../src/parsers.js","../src/tinybind.js","../src/observer.js","../src/bindings.js","../src/view.js","../src/adapter.js","../src/binders.js","../src/formatters.js","../src/component.js","../src/export.js"],"sourcesContent":["export const OPTIONS = [\r\n  'prefix',\r\n  'templateDelimiters',\r\n  'rootInterface',\r\n  'preloadData',\r\n  'handler'\r\n]\r\n\r\nexport const EXTENSIONS = [\r\n  'binders',\r\n  'formatters',\r\n  'adapters'\r\n]","const PRIMITIVE = 0\r\nconst KEYPATH = 1\r\nconst TEXT = 0\r\nconst BINDING = 1\r\n\r\nconst QUOTED_STR = /^'.*'$|^\".*\"$/\r\n\r\n// Parser and tokenizer for getting the type and value from a string.\r\nexport function parseType(string) {\r\n  let type = PRIMITIVE\r\n  let value = string\r\n\r\n  if (QUOTED_STR.test(string)) {\r\n    value = string.slice(1, -1)\r\n  } else if (string === 'true') {\r\n    value = true\r\n  } else if (string === 'false') {\r\n    value = false\r\n  } else if (string === 'null') {\r\n    value = null\r\n  } else if (string === 'undefined') {\r\n    value = undefined\r\n  } else if (!isNaN(string)) {\r\n    value = Number(string)\r\n  } else {\r\n    type = KEYPATH\r\n  }\r\n\r\n  return {type: type, value: value}\r\n}\r\n\r\n// Template parser and tokenizer for mustache-style text content bindings.\r\n// Parses the template and returns a set of tokens, separating static portions\r\n// of text from binding declarations.\r\nexport function parseTemplate(template, delimiters) {\r\n  var tokens\r\n  let length = template.length\r\n  let index = 0\r\n  let lastIndex = 0\r\n  let open = delimiters[0], close = delimiters[1]\r\n\r\n  while (lastIndex < length) {\r\n    index = template.indexOf(open, lastIndex)\r\n\r\n    if (index < 0) {\r\n      if (tokens) {\r\n        tokens.push({\r\n          type: TEXT,\r\n          value: template.slice(lastIndex)\r\n        })\r\n      }\r\n\r\n      break\r\n    } else {\r\n      tokens || (tokens = [])\r\n      if (index > 0 && lastIndex < index) {\r\n        tokens.push({\r\n          type: TEXT,\r\n          value: template.slice(lastIndex, index)\r\n        })\r\n      }\r\n\r\n      lastIndex = index + open.length\r\n      index = template.indexOf(close, lastIndex)\r\n\r\n      if (index < 0) {\r\n        let substring = template.slice(lastIndex - close.length)\r\n        let lastToken = tokens[tokens.length - 1]\r\n\r\n        if (lastToken && lastToken.type === TEXT) {\r\n          lastToken.value += substring\r\n        } else {\r\n          tokens.push({\r\n            type: TEXT,\r\n            value: substring\r\n          })\r\n        }\r\n\r\n        break\r\n      }\r\n\r\n      let value = template.slice(lastIndex, index).trim()\r\n\r\n      tokens.push({\r\n        type: BINDING,\r\n        value: value\r\n      })\r\n\r\n      lastIndex = index + close.length\r\n    }\r\n  }\r\n\r\n  return tokens\r\n}\r\n","import {EXTENSIONS} from './constants'\r\nimport {parseTemplate, parseType} from './parsers'\r\n\r\nconst tinybind = {\r\n  // Global binders.\r\n  binders: {},\r\n\r\n  // Global formatters.\r\n  formatters: {},\r\n\r\n  // Global sightglass adapters.\r\n  adapters: {},\r\n\r\n  // Default attribute prefix.\r\n  _prefix: 'rv',\r\n\r\n  _fullPrefix: 'rv-',\r\n\r\n  get prefix () {\r\n    return this._prefix\r\n  },\r\n\r\n  set prefix (value) {\r\n    this._prefix = value\r\n    this._fullPrefix = value + '-'\r\n  },\r\n\r\n  parseTemplate: parseTemplate,\r\n\r\n  parseType: parseType,\r\n\r\n  // Default template delimiters.\r\n  templateDelimiters: ['{', '}'],\r\n\r\n  // Default sightglass root interface.\r\n  rootInterface: '.',\r\n\r\n  // Preload data by default.\r\n  preloadData: true,\r\n\r\n  // Default event handler.\r\n  handler: function(context, ev, binding) {\r\n    this.call(context, ev, binding.view.models)\r\n  },\r\n\r\n  // Sets the attribute on the element. If no binder above is matched it will fall\r\n  // back to using this binder.\r\n  fallbackBinder: function(el, value) {\r\n    if (value != null) {\r\n      el.setAttribute(this.type, value)\r\n    } else {\r\n      el.removeAttribute(this.type)\r\n    }  \r\n  },\r\n\r\n  // Merges an object literal into the corresponding global options.\r\n  configure: function(options) {\r\n    if (!options) {\r\n      return\r\n    }\r\n    Object.keys(options).forEach(option => {\r\n      let value = options[option]\r\n\r\n      if (EXTENSIONS.indexOf(option) > -1) {\r\n        Object.keys(value).forEach(key => {\r\n          this[option][key] = value[key]\r\n        })\r\n      } else {\r\n        this[option] = value\r\n      }\r\n    })\r\n  }\r\n}\r\n\r\nexport default tinybind\r\n","\r\n// Check if a value is an object than can be observed.\r\nfunction isObject(obj) {\r\n  return typeof obj === 'object' && obj !== null\r\n}\r\n\r\n// Error thrower.\r\nfunction error(message) {\r\n  throw new Error(`[Observer] ${message}`)\r\n}\r\n\r\nlet adapters;\r\nlet interfaces;\r\nlet rootInterface;\r\n\r\n// Constructs a new keypath observer and kicks things off.\r\nclass Observer {\r\n  static updateOptions (options) {\r\n    adapters = options.adapters\r\n    interfaces = Object.keys(adapters)\r\n    rootInterface = options.rootInterface\r\n  }\r\n  \r\n  // Tokenizes the provided keypath string into interface + path tokens for the\r\n  // observer to work with.\r\n  static tokenize (keypath, root) {\r\n    const tokens = [];\r\n    let current = {i: root, path: ''};\r\n    let index;\r\n    let chr;\r\n  \r\n    for (index = 0; index < keypath.length; index++) {\r\n      chr = keypath.charAt(index)\r\n  \r\n      if (!!~interfaces.indexOf(chr)) {\r\n        tokens.push(current)\r\n        current = {i: chr, path: ''}\r\n      } else {\r\n        current.path += chr\r\n      }\r\n    }\r\n  \r\n    tokens.push(current)\r\n    return tokens\r\n  }\r\n\r\n  constructor(obj, keypath, callback) {\r\n    this.keypath = keypath\r\n    this.callback = callback\r\n    this.objectPath = []\r\n    this.parse()\r\n    this.obj = this.getRootObject(obj)\r\n\r\n    if (isObject(this.target = this.realize())) {\r\n      this.set(true, this.key, this.target, this.callback)\r\n    }\r\n  }\r\n\r\n  // Parses the keypath using the interfaces defined on the view. Sets variables\r\n  // for the tokenized keypath as well as the end key.\r\n  parse() {\r\n    let path;\r\n    let root;\r\n\r\n    if (!interfaces.length) {\r\n      error('Must define at least one adapter interface.')\r\n    }\r\n\r\n    if (!!~interfaces.indexOf(this.keypath[0])) {\r\n      root = this.keypath[0]\r\n      path = this.keypath.substr(1)\r\n    } else {\r\n      root = rootInterface\r\n      path = this.keypath\r\n    }\r\n\r\n    this.tokens = Observer.tokenize(path, root)\r\n    this.key = this.tokens.pop()\r\n  }\r\n\r\n  // Realizes the full keypath, attaching observers for every key and correcting\r\n  // old observers to any changed objects in the keypath.\r\n  realize() {\r\n    let current = this.obj;\r\n    let unreached = -1;\r\n    let prev;\r\n    let token;\r\n\r\n    for (let index = 0; index < this.tokens.length; index++) {\r\n      token = this.tokens[index]\r\n      if (isObject(current)) {\r\n        if (typeof this.objectPath[index] !== 'undefined') {\r\n          if (current !== (prev = this.objectPath[index])) {\r\n            this.set(false, token, prev, this)\r\n            this.set(true, token, current, this)\r\n            this.objectPath[index] = current\r\n          }\r\n        } else {\r\n          this.set(true, token, current, this)\r\n          this.objectPath[index] = current\r\n        }\r\n\r\n        current = this.get(token, current)\r\n      } else {\r\n        if (unreached === -1) {\r\n          unreached = index\r\n        }\r\n\r\n        if (prev = this.objectPath[index]) {\r\n          this.set(false, token, prev, this)\r\n        }\r\n      }\r\n    }\r\n\r\n    if (unreached !== -1) {\r\n      this.objectPath.splice(unreached)\r\n    }\r\n\r\n    return current\r\n  }\r\n\r\n  // Updates the keypath. This is called when any intermediary key is changed.\r\n  sync() {\r\n    let next;\r\n    let oldValue;\r\n    let newValue;\r\n\r\n    if ((next = this.realize()) !== this.target) {\r\n      if (isObject(this.target)) {\r\n        this.set(false, this.key, this.target, this.callback)\r\n      }\r\n\r\n      if (isObject(next)) {\r\n        this.set(true, this.key, next, this.callback)\r\n      }\r\n\r\n      oldValue = this.value()\r\n      this.target = next\r\n      newValue = this.value()\r\n      if (newValue !== oldValue || newValue instanceof Function) this.callback.sync()\r\n    } else if (next instanceof Array) {\r\n      this.callback.sync()\r\n    }\r\n  }\r\n\r\n  // Reads the current end value of the observed keypath. Returns undefined if\r\n  // the full keypath is unreachable.\r\n  value() {\r\n    if (isObject(this.target)) {\r\n      return this.get(this.key, this.target)\r\n    }\r\n  }\r\n\r\n  // Sets the current end value of the observed keypath. Calling setValue when\r\n  // the full keypath is unreachable is a no-op.\r\n  setValue(value) {\r\n    if (isObject(this.target)) {\r\n      adapters[this.key.i].set(this.target, this.key.path, value)\r\n    }\r\n  }\r\n\r\n  // Gets the provided key on an object.\r\n  get(key, obj) {\r\n    return adapters[key.i].get(obj, key.path);\r\n  }\r\n\r\n  // Observes or unobserves a callback on the object using the provided key.\r\n  set(active, key, obj, callback) {\r\n    const action = active ? 'observe' : 'unobserve';\r\n    adapters[key.i][action](obj, key.path, callback)\r\n  }\r\n\r\n  // Unobserves the entire keypath.\r\n  unobserve() {\r\n    let obj;\r\n    let token;\r\n\r\n    for (let index = 0; index < this.tokens.length; index++) {\r\n      token = this.tokens[index]\r\n      if (obj = this.objectPath[index]) {\r\n        this.set(false, token, obj, this)\r\n      }\r\n    }\r\n\r\n    if (isObject(this.target)) {\r\n      this.set(false, this.key, this.target, this.callback)\r\n    }\r\n  }\r\n\r\n  // traverse the scope chain to find the scope which has the root property\r\n  // if the property is not found in chain, returns the root scope\r\n  getRootObject(obj) {\r\n    let rootProp;\r\n    let current;\r\n    if (!obj.$parent) {\r\n      return obj;\r\n    }\r\n\r\n    if (this.tokens.length) {\r\n      rootProp = this.tokens[0].path\r\n    } else {\r\n      rootProp = this.key.path\r\n    }\r\n\r\n    current = obj;\r\n    while (current.$parent && (current[rootProp] === undefined)) {\r\n      current = current.$parent\r\n    }\r\n\r\n    return current;\r\n  }\r\n}\r\n\r\nexport default Observer\r\n","import {parseType} from './parsers'\r\nimport Observer from './observer'\r\n\r\nfunction getInputValue(el) {  \r\n  if (el.type === 'checkbox') {\r\n    return el.checked\r\n  } else if (el.type === 'select-multiple') {\r\n    const results = []\r\n    let option\r\n    for (let i = 0; i < el.options.length; i++) {\r\n      option = el.options[i]\r\n      if (option.selected) {\r\n        results.push(option.value);\r\n      }\r\n    }\r\n    return results\r\n  } else {\r\n    return el.value\r\n  }\r\n}\r\n\r\nconst FORMATTER_ARGS =  /[^\\s']+|'([^']|'[^\\s])*'|\"([^\"]|\"[^\\s])*\"/g\r\nconst FORMATTER_SPLIT = /\\s+/\r\n\r\n// A single binding between a model attribute and a DOM element.\r\nexport class Binding {\r\n  // All information about the binding is passed into the constructor; the\r\n  // containing view, the DOM node, the type of binding, the model object and the\r\n  // keypath at which to listen for changes.\r\n  constructor(view, el, type, keypath, binder, arg, formatters) {\r\n    this.view = view\r\n    this.el = el\r\n    this.type = type\r\n    this.keypath = keypath\r\n    this.binder = binder\r\n    this.arg = arg\r\n    this.formatters = formatters\r\n    this.formatterObservers = {}\r\n    this.model = undefined\r\n  }\r\n\r\n  // Observes the object keypath\r\n  observe(obj, keypath) {\r\n    return new Observer(obj, keypath, this)\r\n  }\r\n\r\n  parseTarget() {\r\n    if (this.keypath) {\r\n      let token = parseType(this.keypath)\r\n\r\n      if (token.type === 0) {\r\n        this.value = token.value\r\n      } else {\r\n        this.observer = this.observe(this.view.models, this.keypath)\r\n        this.model = this.observer.target\r\n      }\r\n    } else {\r\n      this.value = undefined;\r\n    }\r\n  }\r\n\r\n  parseFormatterArguments(args, formatterIndex) {\r\n    return args\r\n      .map(parseType)\r\n      .map(({type, value}, ai) => {\r\n        if (type === 0) {\r\n          return value\r\n        } else {\r\n          if (!this.formatterObservers[formatterIndex]) {\r\n            this.formatterObservers[formatterIndex] = {}\r\n          }\r\n\r\n          let observer = this.formatterObservers[formatterIndex][ai]\r\n\r\n          if (!observer) {\r\n            observer = this.observe(this.view.models, value)\r\n            this.formatterObservers[formatterIndex][ai] = observer\r\n          }\r\n\r\n          return observer.value()\r\n        }\r\n      })\r\n  }\r\n\r\n  // Applies all the current formatters to the supplied value and returns the\r\n  // formatted value.\r\n  formattedValue(value) {\r\n    return this.formatters.reduce((result, declaration, index) => {\r\n      let args = declaration.match(FORMATTER_ARGS)\r\n      let id = args.shift()\r\n      let formatter = this.view.options.formatters[id]\r\n\r\n      const processedArgs = this.parseFormatterArguments(args, index)\r\n\r\n      if (formatter && (formatter.read instanceof Function)) {\r\n        result = formatter.read(result, ...processedArgs)\r\n      } else if (formatter instanceof Function) {\r\n        result = formatter(result, ...processedArgs)\r\n      }\r\n      return result\r\n    }, value)\r\n  }\r\n\r\n  // Returns an event handler for the binding around the supplied function.\r\n  eventHandler(fn) {\r\n    let binding = this\r\n    let handler = binding.view.options.handler\r\n\r\n    return function(ev) {\r\n      handler.call(fn, this, ev, binding)\r\n    }\r\n  }\r\n\r\n  // Sets the value for the binding. This Basically just runs the binding routine\r\n  // with the supplied value formatted.\r\n  set(value) {\r\n    if ((value instanceof Function) && !this.binder.function) {\r\n      value = this.formattedValue(value.call(this.model))\r\n    } else {\r\n      value = this.formattedValue(value)\r\n    }\r\n\r\n    let routineFn = this.binder.routine || this.binder\r\n\r\n    if (routineFn instanceof Function) {\r\n      routineFn.call(this, this.el, value)\r\n    }\r\n  }\r\n\r\n  // Syncs up the view binding with the model.\r\n  sync() {\r\n    if (this.observer) {\r\n      this.model = this.observer.target\r\n      this.set(this.observer.value())\r\n    } else {\r\n      this.set(this.value)\r\n    }\r\n  }\r\n\r\n  // Publishes the value currently set on the input element back to the model.\r\n  publish() {\r\n    if (this.observer) {\r\n      var value = this.formatters.reduceRight((result, declaration, index) => {\r\n        const args = declaration.split(FORMATTER_SPLIT)\r\n        const id = args.shift()\r\n        const formatter = this.view.options.formatters[id]\r\n        const processedArgs = this.parseFormatterArguments(args, index)\r\n\r\n        if (formatter && formatter.publish) {\r\n          result = formatter.publish(result, ...processedArgs)\r\n        }\r\n        return result\r\n      }, this.getValue(this.el))\r\n\r\n      this.observer.setValue(value)\r\n    }\r\n  }\r\n\r\n  // Subscribes to the model for changes at the specified keypath. Bi-directional\r\n  // routines will also listen for changes on the element to propagate them back\r\n  // to the model.\r\n  bind() {\r\n    this.parseTarget()\r\n\r\n    if (this.binder.hasOwnProperty('bind')) {\r\n      this.binder.bind.call(this, this.el)\r\n    }\r\n\r\n    if (this.view.options.preloadData) {\r\n      this.sync()\r\n    }\r\n  }\r\n\r\n  // Unsubscribes from the model and the element.\r\n  unbind() {\r\n    if (this.binder.unbind) {\r\n      this.binder.unbind.call(this, this.el)\r\n    }\r\n\r\n    if (this.observer) {\r\n      this.observer.unobserve()\r\n    }\r\n\r\n    Object.keys(this.formatterObservers).forEach(fi => {\r\n      let args = this.formatterObservers[fi]\r\n\r\n      Object.keys(args).forEach(ai => {\r\n        args[ai].unobserve()\r\n      })\r\n    })\r\n\r\n    this.formatterObservers = {}\r\n  }\r\n\r\n  // Updates the binding's model from what is currently set on the view. Unbinds\r\n  // the old model first and then re-binds with the new model.\r\n  update(models = {}) {\r\n    if (this.observer) {\r\n      this.model = this.observer.target\r\n    }\r\n\r\n    if (this.binder.update) {\r\n      this.binder.update.call(this, models)\r\n    }\r\n  }\r\n\r\n  // Returns elements value\r\n  getValue(el) {\r\n    if (this.binder && this.binder.getValue) {\r\n      return this.binder.getValue.call(this, el)\r\n    } else {\r\n      return getInputValue(el)\r\n    }\r\n  }\r\n}\r\n","import tinybind from './tinybind'\r\nimport {Binding} from './bindings'\r\nimport {parseTemplate} from './parsers'\r\n\r\nconst textBinder = {\r\n  routine: (node, value) => {\r\n    node.data = (value != null) ? value : ''\r\n  }\r\n}\r\n\r\nconst DECLARATION_SPLIT = /((?:'[^']*')*(?:(?:[^\\|']*(?:'[^']*')+[^\\|']*)+|[^\\|]+))|^$/g\r\n\r\nconst parseNode = (view, node) => {\r\n  let block = false\r\n\r\n  if (node.nodeType === 3) {\r\n    let tokens = parseTemplate(node.data, tinybind.templateDelimiters)\r\n\r\n    if (tokens) {\r\n      for (let i = 0; i < tokens.length; i++) {\r\n        let token = tokens[i]\r\n        let text = document.createTextNode(token.value)\r\n        node.parentNode.insertBefore(text, node)\r\n\r\n        if (token.type === 1) {\r\n          view.buildBinding(text, null, token.value, textBinder, null)\r\n        }\r\n      }\r\n\r\n      node.parentNode.removeChild(node)\r\n    }\r\n    block = true\r\n  } else if (node.nodeType === 1) {\r\n    block = view.traverse(node)\r\n  }\r\n\r\n  if (!block) {\r\n    for (let i = 0; i < node.childNodes.length; i++) {\r\n      parseNode(view, node.childNodes[i]);\r\n    }\r\n  }\r\n}\r\n\r\nconst bindingComparator = (a, b) => {\r\n  let aPriority = a.binder ? (a.binder.priority || 0) : 0\r\n  let bPriority = b.binder ? (b.binder.priority || 0) : 0\r\n  return bPriority - aPriority\r\n}\r\n\r\nconst trimStr = (str) => {\r\n  return str.trim()\r\n}\r\n\r\n// A collection of bindings built from a set of parent nodes.\r\nexport default class View {\r\n  // The DOM elements and the model objects for binding are passed into the\r\n  // constructor along with any local options that should be used throughout the\r\n  // context of the view and it's bindings.\r\n  constructor(els, models, options) {\r\n    if (els.jquery || els instanceof Array) {\r\n      this.els = els\r\n    } else {\r\n      this.els = [els]\r\n    }\r\n\r\n    this.models = models\r\n    this.options = options\r\n\r\n    this.build()\r\n  }\r\n\r\n\r\n  buildBinding(node, type, declaration, binder, arg) {\r\n    let pipes = declaration.match(DECLARATION_SPLIT).map(trimStr)\r\n\r\n    let keypath = pipes.shift()\r\n\r\n    this.bindings.push(new Binding(this, node, type, keypath, binder, arg, pipes))\r\n  }\r\n\r\n  // Parses the DOM tree and builds `Binding` instances for every matched\r\n  // binding declaration.\r\n  build() {\r\n    this.bindings = []\r\n\r\n    let elements = this.els, i, len;\r\n    for (i = 0, len = elements.length; i < len; i++) {\r\n      parseNode(this, elements[i])\r\n    }\r\n\r\n    this.bindings.sort(bindingComparator)\r\n  }\r\n\r\n  traverse(node) {\r\n    let bindingPrefix = tinybind._fullPrefix\r\n    let block = node.nodeName === 'SCRIPT' || node.nodeName === 'STYLE'\r\n    let attributes = node.attributes\r\n    let bindInfos = []\r\n    let starBinders = this.options.starBinders\r\n    var type, binder, identifier, arg\r\n\r\n\r\n    for (let i = 0, len = attributes.length; i < len; i++) {\r\n      let attribute = attributes[i]\r\n      if (attribute.name.indexOf(bindingPrefix) === 0) {\r\n        type = attribute.name.slice(bindingPrefix.length)\r\n        binder = this.options.binders[type]\r\n        arg = undefined\r\n\r\n        if (!binder) {\r\n          for (let k = 0; k < starBinders.length; k++) {\r\n            identifier = starBinders[k]\r\n            if (type.slice(0, identifier.length - 1) === identifier.slice(0, -1)) {\r\n              binder = this.options.binders[identifier]\r\n              arg = type.slice(identifier.length - 1)\r\n              break\r\n            }\r\n          }\r\n        }\r\n\r\n        if (!binder) {\r\n          binder = tinybind.fallbackBinder\r\n        }\r\n\r\n        if (binder.block) {\r\n          this.buildBinding(node, type, attribute.value, binder, arg)\r\n          node.removeAttribute(attribute.name)\r\n          return true;\r\n        }\r\n\r\n        bindInfos.push({attr: attribute, binder: binder, type: type, arg: arg})\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < bindInfos.length; i++) {\r\n      let bindInfo = bindInfos[i]\r\n      this.buildBinding(node, bindInfo.type, bindInfo.attr.value, bindInfo.binder, bindInfo.arg)\r\n      node.removeAttribute(bindInfo.attr.name)\r\n    }\r\n\r\n    return block\r\n  }\r\n\r\n  // Binds all of the current bindings for this view.\r\n  bind() {\r\n    this.bindings.forEach(binding => {\r\n      binding.bind()\r\n    })\r\n  }\r\n\r\n  // Unbinds all of the current bindings for this view.\r\n  unbind() {\r\n    this.bindings.forEach(binding => {\r\n      binding.unbind()\r\n    })\r\n  }\r\n\r\n  // Syncs up the view with the model by running the routines on all bindings.\r\n  sync() {\r\n    this.bindings.forEach(binding => {\r\n      binding.sync()\r\n    })\r\n  }\r\n\r\n  // Publishes the input values from the view back to the model (reverse sync).\r\n  publish() {\r\n    this.bindings.forEach(binding => {\r\n      if (binding.binder && binding.binder.publishes) {\r\n        binding.publish()\r\n      }\r\n    })\r\n  }\r\n\r\n  // Updates the view's models along with any affected bindings.\r\n  update(models = {}) {\r\n    Object.keys(models).forEach(key => {\r\n      this.models[key] = models[key]\r\n    })\r\n\r\n    this.bindings.forEach(binding => {\r\n      if (binding.update) {\r\n        binding.update(models)\r\n      }\r\n    })\r\n  }\r\n}\r\n","// The default `.` adapter that comes with tinybind.js. Allows subscribing to\r\n// properties on plain objects, implemented in ES5 natives using\r\n// `Object.defineProperty`.\r\n\r\nconst ARRAY_METHODS = [\r\n  'push',\r\n  'pop',\r\n  'shift',\r\n  'unshift',\r\n  'sort',\r\n  'reverse',\r\n  'splice'\r\n]\r\n\r\nconst adapter = {\r\n  counter: 0,\r\n  weakmap: {},\r\n\r\n  weakReference: function(obj) {\r\n    if (!obj.hasOwnProperty('__rv')) {\r\n      let id = this.counter++\r\n\r\n      Object.defineProperty(obj, '__rv', {\r\n        value: id\r\n      })\r\n    }\r\n\r\n    if (!this.weakmap[obj.__rv]) {\r\n      this.weakmap[obj.__rv] = {\r\n        callbacks: {}\r\n      }\r\n    }\r\n\r\n    return this.weakmap[obj.__rv]\r\n  },\r\n\r\n  cleanupWeakReference: function(data, refId) {\r\n    if (!Object.keys(data.callbacks).length) {\r\n      if (!(data.pointers && Object.keys(data.pointers).length)) {\r\n        delete this.weakmap[refId]\r\n      }\r\n    }\r\n  },\r\n\r\n  stubFunction: function(obj, fn) {\r\n    const original = obj[fn]\r\n    const data = this.weakReference(obj)\r\n    const weakmap = this.weakmap\r\n\r\n    obj[fn] = (...args) => {\r\n      let response = original.apply(obj, args)\r\n\r\n      Object.keys(data.pointers).forEach(refId => {\r\n        let k = data.pointers[refId]\r\n\r\n        if (weakmap[refId]) {\r\n          if (weakmap[refId].callbacks[k] instanceof Array) {\r\n            weakmap[refId].callbacks[k].forEach(callback => {\r\n              callback.sync()\r\n            })\r\n          }\r\n        }\r\n      })\r\n\r\n      return response\r\n    }\r\n  },\r\n\r\n  observeArray: function(value, refId, keypath) {\r\n    if (value instanceof Array) {\r\n      let data = this.weakReference(value)\r\n\r\n      if (!data.pointers) {\r\n        data.pointers = {}\r\n\r\n        ARRAY_METHODS.forEach(fn => {\r\n          this.stubFunction(value, fn)\r\n        })\r\n      }\r\n\r\n      if (!data.pointers[refId]) {\r\n        data.pointers[refId] = []\r\n      }\r\n\r\n      if (data.pointers[refId].indexOf(keypath) === -1) {\r\n        data.pointers[refId].push(keypath)\r\n      }\r\n    }\r\n  },\r\n\r\n  unobserveArray: function(value, refId, keypath) {\r\n    if ((value instanceof Array) && (value.__rv != null)) {\r\n      let data = this.weakmap[value.__rv]\r\n\r\n      if (data) {\r\n        let pointers = data.pointers[refId]\r\n\r\n        if (pointers) {\r\n          let idx = pointers.indexOf(keypath)\r\n\r\n          if (idx > -1) {\r\n            pointers.splice(idx, 1)\r\n          }\r\n\r\n          if (!pointers.length) {\r\n            delete data.pointers[refId]\r\n          }\r\n\r\n          this.cleanupWeakReference(data, value.__rv)\r\n        }\r\n      }\r\n    }\r\n  },\r\n\r\n  observe: function(obj, keypath, callback) {\r\n    let value    \r\n    const callbacks = this.weakReference(obj).callbacks\r\n\r\n    if (!callbacks[keypath]) {\r\n      callbacks[keypath] = []\r\n      let desc = Object.getOwnPropertyDescriptor(obj, keypath)\r\n\r\n      if (!desc || !(desc.get || desc.set || !desc.configurable)) {\r\n        value = obj[keypath]\r\n\r\n        Object.defineProperty(obj, keypath, {\r\n          enumerable: true,\r\n\r\n          get: () => {\r\n            return value\r\n          },\r\n\r\n          set: newValue => {\r\n            if (newValue !== value) {\r\n              this.unobserveArray(value, obj.__rv, keypath)\r\n              value = newValue\r\n              const data = this.weakmap[obj.__rv]\r\n\r\n              if (data) {\r\n                let callbacks = data.callbacks[keypath]\r\n\r\n                if (callbacks) {\r\n                  callbacks.forEach(cb => {\r\n                      cb.sync()\r\n                  })\r\n                }\r\n\r\n                this.observeArray(newValue, obj.__rv, keypath)\r\n              }\r\n            }\r\n          }\r\n        })\r\n      }\r\n    }\r\n\r\n    if (callbacks[keypath].indexOf(callback) === -1) {\r\n      callbacks[keypath].push(callback)\r\n    }\r\n\r\n    this.observeArray(obj[keypath], obj.__rv, keypath)\r\n  },\r\n\r\n  unobserve: function(obj, keypath, callback) {\r\n    let data = this.weakmap[obj.__rv]\r\n\r\n    if (data) {\r\n      let callbacks = data.callbacks[keypath]\r\n\r\n      if (callbacks) {\r\n        let idx = callbacks.indexOf(callback)\r\n\r\n        if (idx > -1) {\r\n          callbacks.splice(idx, 1)\r\n\r\n          if (!callbacks.length) {\r\n            delete data.callbacks[keypath]\r\n            this.unobserveArray(obj[keypath], obj.__rv, keypath)\r\n          }\r\n        }\r\n\r\n        this.cleanupWeakReference(data, obj.__rv)\r\n      }\r\n    }\r\n  },\r\n\r\n  get: function(obj, keypath) {\r\n    return obj[keypath]\r\n  },\r\n\r\n  set: (obj, keypath, value) => {\r\n    obj[keypath] = value\r\n  }\r\n}\r\n\r\nexport default adapter\r\n","import View from './view'\r\n\r\nconst getString = (value) => {\r\n  return value != null ? value.toString() : undefined\r\n}\r\n\r\nconst times = (n, cb) => {\r\n  for (let i = 0; i < n; i++) cb()\r\n}\r\n\r\nfunction createView(binding, data, anchorEl) {\r\n  let template = binding.el.cloneNode(true)\r\n  let view = new View(template, data, binding.view.options)\r\n  view.bind()\r\n  binding.marker.parentNode.insertBefore(template, anchorEl)\r\n  return view\r\n}\r\n\r\nconst binders = {\r\n  // Binds an event handler on the element.\r\n  'on-*': {\r\n    function: true,\r\n    priority: 1000,\r\n\r\n    unbind: function(el) {\r\n      if (this.handler) {\r\n        el.removeEventListener(this.arg, this.handler)\r\n      }\r\n    },\r\n\r\n    routine: function(el, value) {\r\n      if (this.handler) {\r\n        el.removeEventListener(this.arg, this.handler)\r\n      }\r\n\r\n      this.handler = this.eventHandler(value)\r\n      el.addEventListener(this.arg, this.handler)\r\n    }\r\n  },\r\n\r\n  // Appends bound instances of the element in place for each item in the array.\r\n  'each-*': {\r\n    block: true,\r\n\r\n    priority: 4000,\r\n\r\n    bind: function(el) {\r\n      if (!this.marker) {\r\n        this.marker = document.createComment(` tinybind: ${this.type} `)\r\n        this.iterated = []\r\n\r\n        el.parentNode.insertBefore(this.marker, el)\r\n        el.parentNode.removeChild(el)\r\n      } else {\r\n        this.iterated.forEach(view => {\r\n          view.bind()\r\n        })\r\n      }\r\n    },\r\n\r\n    unbind: function(el) {\r\n      if (this.iterated) {\r\n        this.iterated.forEach(view => {\r\n          view.unbind()\r\n        })\r\n      }\r\n    },\r\n\r\n    routine: function(el, collection) {\r\n      let modelName = this.arg\r\n      collection = collection || []\r\n      let indexProp = el.getAttribute('index-property') || '$index'\r\n\r\n      collection.forEach((model, index) => {\r\n        let data = {$parent: this.view.models}\r\n        data[indexProp] = index\r\n        data[modelName] = model\r\n        let view = this.iterated[index]\r\n\r\n        if (!view) {\r\n\r\n          let previous = this.marker\r\n\r\n          if (this.iterated.length) {\r\n            previous = this.iterated[this.iterated.length - 1].els[0]\r\n          }\r\n\r\n          view = createView(this, data, previous.nextSibling)\r\n          this.iterated.push(view)\r\n        } else {\r\n          if (view.models[modelName] !== model) {\r\n            // search for a view that matches the model\r\n            let matchIndex, nextView\r\n            for (let nextIndex = index + 1; nextIndex < this.iterated.length; nextIndex++) {\r\n              nextView = this.iterated[nextIndex]\r\n              if (nextView.models[modelName] === model) {\r\n                matchIndex = nextIndex\r\n                break\r\n              }\r\n            }\r\n            if (matchIndex !== undefined) {\r\n              // model is in other position\r\n              // todo: consider avoiding the splice here by setting a flag\r\n              // profile performance before implementing such change\r\n              this.iterated.splice(matchIndex, 1)\r\n              this.marker.parentNode.insertBefore(nextView.els[0], view.els[0])\r\n              nextView.models[indexProp] = index\r\n            } else {\r\n              //new model\r\n              nextView = createView(this, data, view.els[0])\r\n            }\r\n            this.iterated.splice(index, 0, nextView)\r\n          } else {\r\n            view.models[indexProp] = index\r\n          }\r\n        }\r\n      })\r\n\r\n      if (this.iterated.length > collection.length) {\r\n        times(this.iterated.length - collection.length, () => {\r\n          let view = this.iterated.pop()\r\n          view.unbind()\r\n          this.marker.parentNode.removeChild(view.els[0])\r\n        })\r\n      }\r\n\r\n      if (el.nodeName === 'OPTION') {\r\n        this.view.bindings.forEach(binding => {\r\n          if (binding.el === this.marker.parentNode && binding.type === 'value') {\r\n            binding.sync()\r\n          }\r\n        })\r\n      }\r\n    },\r\n\r\n    update: function(models) {\r\n      let data = {}\r\n\r\n      //todo: add test and fix if necessary\r\n\r\n      Object.keys(models).forEach(key => {\r\n        if (key !== this.arg) {\r\n          data[key] = models[key]\r\n        }\r\n      })\r\n\r\n      this.iterated.forEach(view => {\r\n        view.update(data)\r\n      })\r\n    }\r\n  },\r\n\r\n  // Adds or removes the class from the element when value is true or false.\r\n  'class-*': function(el, value) {\r\n    let elClass = ` ${el.className} `\r\n\r\n    if (!value === (elClass.indexOf(` ${this.arg} `) > -1)) {\r\n      if (value) {\r\n        el.className = `${el.className} ${this.arg}`\r\n      } else {\r\n        el.className = elClass.replace(` ${this.arg} `, ' ').trim()\r\n      }\r\n    }\r\n  },\r\n\r\n  // Sets the element's text value.\r\n  text: (el, value) => {\r\n    el.textContent = value != null ? value : ''\r\n  },\r\n\r\n  // Sets the element's HTML content.\r\n  html: (el, value) => {\r\n    el.innerHTML = value != null ? value : ''\r\n  },\r\n\r\n  // Shows the element when value is true.\r\n  show: (el, value) => {\r\n    el.style.display = value ? '' : 'none'\r\n  },\r\n\r\n  // Hides the element when value is true (negated version of `show` binder).\r\n  hide: (el, value) => {\r\n    el.style.display = value ? 'none' : ''\r\n  },\r\n\r\n  // Enables the element when value is true.\r\n  enabled: (el, value) => {\r\n    el.disabled = !value\r\n  },\r\n\r\n  // Disables the element when value is true (negated version of `enabled` binder).\r\n  disabled: (el, value) => {\r\n    el.disabled = !!value\r\n  },\r\n\r\n  // Checks a checkbox or radio input when the value is true. Also sets the model\r\n  // property when the input is checked or unchecked (two-way binder).\r\n  checked: {\r\n    publishes: true,\r\n    priority: 2000,\r\n\r\n    bind: function(el) {\r\n      var self = this;\r\n      if (!this.callback) {\r\n        this.callback = function () {\r\n          self.publish();\r\n        }\r\n      }\r\n      el.addEventListener('change', this.callback)\r\n    },\r\n\r\n    unbind: function(el) {\r\n      el.removeEventListener('change', this.callback)\r\n    },\r\n\r\n    routine: function(el, value) {\r\n      if (el.type === 'radio') {\r\n        el.checked = getString(el.value) === getString(value)\r\n      } else {\r\n        el.checked = !!value\r\n      }\r\n    }\r\n  },\r\n\r\n  // Sets the element's value. Also sets the model property when the input changes\r\n  // (two-way binder).\r\n  value: {\r\n    publishes: true,\r\n    priority: 3000,\r\n\r\n    bind: function(el) {\r\n      this.isRadio = el.tagName === 'INPUT' && el.type === 'radio';\r\n      if (!this.isRadio) {\r\n        this.event = el.getAttribute('event-name') || (el.tagName === 'SELECT' ? 'change' : 'input')\r\n\r\n        var self = this;\r\n        if (!this.callback) {\r\n          this.callback = function () {\r\n            self.publish();\r\n          }\r\n        }\r\n\r\n        el.addEventListener(this.event, this.callback)\r\n      }\r\n    },\r\n\r\n    unbind: function(el) {\r\n      if (!this.isRadio) {\r\n        el.removeEventListener(this.event, this.callback)\r\n      }\r\n    },\r\n\r\n    routine: function(el, value) {\r\n      if (this.isRadio) {\r\n        el.setAttribute('value', value)\r\n      } else {\r\n        if (el.type === 'select-multiple') {\r\n          if (value instanceof Array) {\r\n            for (let i = 0; i < el.length; i++) {\r\n              let option = el[i];\r\n              option.selected = value.indexOf(option.value) > -1\r\n            }\r\n          }\r\n        } else if (getString(value) !== getString(el.value)) {\r\n          el.value = value != null ? value : ''\r\n        }\r\n      }\r\n    }\r\n  },\r\n\r\n  // Inserts and binds the element and it's child nodes into the DOM when true.\r\n  if: {\r\n    block: true,\r\n    priority: 4000,\r\n\r\n    bind: function(el) {\r\n      if (!this.marker) {\r\n        this.marker = document.createComment(' tinybind: ' + this.type + ' ' + this.keypath + ' ');\r\n        this.attached = false\r\n\r\n        el.parentNode.insertBefore(this.marker, el)\r\n        el.parentNode.removeChild(el)\r\n      } else if (this.bound === false && this.nested) {\r\n        this.nested.bind()\r\n      }\r\n      this.bound = true\r\n    },\r\n\r\n    unbind: function() {\r\n      if (this.nested) {\r\n        this.nested.unbind()\r\n        this.bound = false\r\n      }\r\n    },\r\n\r\n    routine: function(el, value) {\r\n      if (!!value !== this.attached) {\r\n        if (value) {\r\n\r\n          if (!this.nested) {\r\n            this.nested = new View(el, this.view.models, this.view.options)\r\n            this.nested.bind()\r\n          }\r\n\r\n          this.marker.parentNode.insertBefore(el, this.marker.nextSibling)\r\n          this.attached = true\r\n        } else {\r\n          el.parentNode.removeChild(el)\r\n          this.attached = false\r\n        }\r\n      }\r\n    },\r\n\r\n    update: function(models) {\r\n      if (this.nested) {\r\n        this.nested.update(models)\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport default binders\r\n","const formatters = {\r\n  watch: function(value) {\r\n    return value;\r\n  },\r\n\r\n  not: function(value) {\r\n    return !value;\r\n  },\r\n\r\n  negate: function(value) {\r\n    return !value;\r\n  }\r\n}\r\n\r\nexport default formatters","\r\nimport tinybind from './tinybind'\r\n\r\nclass Component extends HTMLElement {\r\n  static get observedAttributes() {\r\n    const template = this.template\r\n    if (!template) {\r\n      throw new Error(`No template declared for ${this.name}`)\r\n    }\r\n\r\n    this.__templateEl = document.createElement('template')\r\n    this.__templateEl.innerHTML = template\r\n    \r\n    const propAttributeMap = this.__propAttributeMap = {}\r\n    const attributes = []\r\n    const properties = this.properties\r\n    if (properties) {\r\n      Object.keys(properties).forEach(propName => {\r\n        const propConfig = properties[propName]\r\n        const attrName = typeof propConfig === 'string' ? propConfig : propName\r\n        propAttributeMap[attrName] = propName\r\n        attributes.push(attrName)\r\n      })\r\n    }    \r\n    return attributes\r\n  }\r\n\r\n  connectedCallback() {\r\n    const nodes = this.constructor.__templateEl.content.cloneNode(true)\r\n    this.__tinybindView = tinybind.bind(nodes, this)    \r\n    while (this.firstChild) {\r\n      this.removeChild(this.firstChild);\r\n    }\r\n    this.appendChild(nodes)\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    this.__tinybindView.unbind()    \r\n  }\r\n\r\n  attributeChangedCallback(name, old, value) {\r\n    if (old !== value) {      \r\n      const propName = this.constructor.__propAttributeMap[name]\r\n      this[propName] = value\r\n    }\r\n  }  \r\n}\r\n\r\nexport default Component","import tinybind from './tinybind'\r\nimport View from './view'\r\nimport {OPTIONS, EXTENSIONS} from './constants'\r\nimport adapter from './adapter'\r\nimport binders from './binders'\r\nimport formatters from './formatters'\r\nimport Observer from './observer'\r\nimport Component from './component'\r\n\r\n// Returns the public interface.\r\n\r\ntinybind.binders = binders\r\ntinybind.formatters = formatters\r\ntinybind.adapters['.'] = adapter\r\ntinybind.Component = Component\r\n\r\n// Binds some data to a template / element. Returns a tinybind.View instance.\r\ntinybind.bind = (el, models, options) => {\r\n  let viewOptions = {}\r\n  models = models || {}\r\n  options = options || {}\r\n\r\n  EXTENSIONS.forEach(extensionType => {\r\n    viewOptions[extensionType] = Object.create(null)\r\n\r\n    if (options[extensionType]) {\r\n      Object.keys(options[extensionType]).forEach(key => {\r\n        viewOptions[extensionType][key] = options[extensionType][key]\r\n      })\r\n    }\r\n\r\n    Object.keys(tinybind[extensionType]).forEach(key => {\r\n      if (!viewOptions[extensionType][key]) {\r\n        viewOptions[extensionType][key] = tinybind[extensionType][key]\r\n      }\r\n    })\r\n  })\r\n\r\n  OPTIONS.forEach(option => {\r\n    let value = options[option]\r\n    viewOptions[option] = value != null ? value : tinybind[option]\r\n  })\r\n\r\n  viewOptions.starBinders = Object.keys(viewOptions.binders).filter(function (key) {\r\n    return key.indexOf('*') > 0\r\n  })\r\n\r\n  Observer.updateOptions(viewOptions)\r\n\r\n  let view = new View(el, models, viewOptions)\r\n  view.bind()\r\n  return view\r\n}\r\n\r\nexport default tinybind\r\n"],"names":["OPTIONS","EXTENSIONS","PRIMITIVE","KEYPATH","TEXT","BINDING","QUOTED_STR","parseType","string","type","value","test","slice","undefined","isNaN","Number","parseTemplate","template","delimiters","tokens","length","index","lastIndex","open","close","indexOf","push","substring","lastToken","trim","tinybind","binders","formatters","adapters","_prefix","_fullPrefix","prefix","templateDelimiters","rootInterface","preloadData","handler","context","ev","binding","call","view","models","fallbackBinder","el","setAttribute","removeAttribute","configure","options","Object","keys","forEach","option","key","isObject","obj","error","message","Error","interfaces","Observer","updateOptions","tokenize","keypath","root","current","i","path","chr","charAt","callback","objectPath","parse","getRootObject","target","realize","set","substr","pop","unreached","prev","token","get","splice","sync","next","oldValue","newValue","Function","Array","setValue","active","action","unobserve","rootProp","$parent","getInputValue","checked","results","selected","FORMATTER_ARGS","FORMATTER_SPLIT","Binding","binder","arg","formatterObservers","model","observe","parseTarget","observer","parseFormatterArguments","args","formatterIndex","map","ai","formattedValue","reduce","result","declaration","match","id","shift","formatter","processedArgs","read","eventHandler","fn","function","routineFn","routine","publish","reduceRight","split","getValue","bind","hasOwnProperty","unbind","fi","update","textBinder","node","data","DECLARATION_SPLIT","parseNode","block","nodeType","text","document","createTextNode","parentNode","insertBefore","buildBinding","removeChild","traverse","childNodes","bindingComparator","a","b","aPriority","priority","bPriority","trimStr","str","View","els","jquery","build","pipes","bindings","elements","len","sort","bindingPrefix","nodeName","attributes","bindInfos","starBinders","identifier","attribute","name","k","attr","bindInfo","publishes","ARRAY_METHODS","adapter","counter","weakmap","weakReference","defineProperty","__rv","callbacks","cleanupWeakReference","refId","pointers","stubFunction","original","response","apply","observeArray","unobserveArray","idx","desc","getOwnPropertyDescriptor","configurable","enumerable","cb","getString","toString","times","n","createView","anchorEl","cloneNode","marker","removeEventListener","addEventListener","createComment","iterated","collection","modelName","indexProp","getAttribute","previous","nextSibling","matchIndex","nextView","nextIndex","elClass","className","replace","textContent","html","innerHTML","show","style","display","hide","enabled","disabled","self","isRadio","tagName","event","if","attached","bound","nested","watch","not","negate","Component","connectedCallback","nodes","constructor","__templateEl","content","__tinybindView","firstChild","appendChild","disconnectedCallback","attributeChangedCallback","old","propName","__propAttributeMap","createElement","propAttributeMap","properties","propConfig","attrName","HTMLElement","viewOptions","extensionType","create","filter"],"mappings":"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"}